<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì˜¤ëŠ˜ ë­ ë¨¹ì§€?</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Arial&display=swap" />
  <style>
    body { font-family: Arial, sans-serif; background: #fafafa; padding: 20px; }
    h1 { text-align: center; }
    .container { max-width: 600px; margin: auto; }
    input, select, button { width: 100%; margin: 8px 0; padding: 10px; border-radius: 6px; border: 1px solid #ccc; }
    button { background-color: #f97316; color: white; font-weight: bold; box-shadow: 0 4px #d65a00; }
    button:active { transform: translateY(2px); box-shadow: 0 2px #b94700; }
    .result-card { background: #fff; padding: 15px; margin-top: 16px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .highlight { font-weight: bold; color: #f97316; }
    .actions button { width: 48%; margin-top: 5px; background: #eee; color: #333; }
    .actions { display: flex; justify-content: space-between; }
    #ingredientList span { background: #f1f1f1; margin: 2px; padding: 6px 10px; border-radius: 20px; display: inline-block; cursor: pointer; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ½ï¸ ì˜¤ëŠ˜ ë­ ë¨¹ì§€?</h1>
    <input id="ingredientInput" placeholder="ì˜ˆ: ë¼ì§€ê³ ê¸°" />
    <div style="display:flex; gap:10px;">
      <button onclick="addIngredient()">ì¬ë£Œ ì¶”ê°€</button>
      <button onclick="resetIngredients()">ì´ˆê¸°í™”</button>
    </div>
    <div id="ingredientList"></div>
    <select id="mealType">
      <option value="">ì‹ì‚¬ ìœ í˜•</option>
      <option>ì•„ì¹¨</option><option>ì ì‹¬</option><option>ì €ë…</option>
      <option>ê°„ì‹</option><option>ì•¼ì‹</option><option>ìˆ ì•ˆì£¼</option><option>ë„ì‹œë½</option>
    </select>
    <select id="dietType">
      <option value="">ì‹ë‹¨ ìœ í˜•</option>
      <option>ì¼ë°˜ì‹</option><option>ê±´ê°•ì‹</option><option>ë‹¤ì´ì–´íŠ¸ì‹</option><option>ì±„ì‹</option>
    </select>
    <select id="cookMethod">
      <option value="">ì¡°ë¦¬ ë°©ë²• (ì„ íƒì—†ìœ¼ë©´ ëœë¤)</option>
      <option>ë³¶ê¸°</option><option>ë“ì´ê¸°</option><option>ì°œ</option><option>ë¬´ì¹¨</option><option>êµ½ê¸°</option>
    </select>
    <button onclick="generateMenu()">ì¶”ì²œí•˜ê¸°</button>
    <button onclick="clearResult()">ë‹¤ì‹œ ì¶”ì²œë°›ê¸°</button>
    <div id="result"></div>

    <h3>ğŸ—“ï¸ ë‚ ì§œë³„ ë©”ë‰´ ê¸°ë¡</h3>
    <input type="date" id="dateSelector" onchange="loadSavedMenu()" />
    <div id="savedMenuDisplay"></div>

    <h3>ğŸ“Š ì£¼ê°„ ì‹ë‹¨ ìš”ì•½</h3>
    <button onclick="loadWeeklySummary()">ì´ë²ˆ ì£¼ ìš”ì•½ ë³´ê¸°</button>
    <div id="weeklySummary"></div>
  </div>

  <script>
    let ingredients = [], recipeDB = [];

    async function loadRecipes() {
      const res = await fetch("https://today-recipe-generators.vercel.app/public_recipes_2000_tagged.json");
      recipeDB = await res.json();
    }

    function addIngredient() {
      const input = document.getElementById('ingredientInput');
      const value = input.value.trim();
      if (value && !ingredients.includes(value)) {
        ingredients.push(value);
        input.value = '';
        renderIngredients();
      }
    }

    function resetIngredients() {
      ingredients = [];
      renderIngredients();
    }

    function renderIngredients() {
      const container = document.getElementById('ingredientList');
      container.innerHTML = ingredients.map(i => `<span onclick="removeIngredient('${i}')">${i} âœ•</span>`).join(' ');
    }

    function removeIngredient(name) {
      ingredients = ingredients.filter(i => i !== name);
      renderIngredients();
    }

    function clearResult() {
      document.getElementById('result').innerHTML = '';
    }

    function generateMenu() {
      const meal = document.getElementById('mealType').value;
      const diet = document.getElementById('dietType').value;
      const method = document.getElementById('cookMethod').value;
      if (!ingredients.length) return alert('ì¬ë£Œë¥¼ í•˜ë‚˜ ì´ìƒ ì…ë ¥í•˜ì„¸ìš”.');

      let candidates = recipeDB.filter(r =>
        (!meal || r.mealType === meal) &&
        (!diet || r.dietType === diet) &&
        (!method || r.method === method) &&
        r.ingredients.some(i => ingredients.includes(i))
      ).map(r => ({
        ...r,
        matchScore: r.ingredients.filter(i => ingredients.includes(i)).length
      }))
      .sort((a,b) => b.matchScore - a.matchScore)
      .slice(0,3);

      const result = document.getElementById('result');
      result.innerHTML = candidates.length
        ? candidates.map(c => `
          <div class="result-card">
            <strong>${c.menu}</strong><br>
            <div>ì‚¬ìš©ëœ ì¬ë£Œ: ${c.ingredients.map(i => ingredients.includes(i) ? `<span class="highlight">${i}</span>` : i).join(', ')}</div>
            <div>ì¼ì¹˜ ì¬ë£Œ ìˆ˜: ${c.matchScore}</div>
            <div>ì¹¼ë¡œë¦¬: ${c.kcal} kcal</div>
            <div class="actions">
              <button onclick="copyMenu('${c.menu}')">ë³µì‚¬</button>
              <button onclick="saveMenu('${c.menu}', ${c.kcal})">ì €ì¥</button>
            </div>
          </div>`).join('')
        : '<p>ì¡°ê±´ì— ë§ëŠ” ë©”ë‰´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>ì¡°ê±´ì„ ì™„í™”í•˜ê±°ë‚˜ ë‹¤ì‹œ ì‹œë„í•´ ë³´ì„¸ìš”.</p>';
    }

    function copyMenu(text) {
      navigator.clipboard.writeText(text);
      alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    function saveMenu(text, kcal) {
      const d = new Date().toISOString().split("T")[0];
      localStorage.setItem(`menu_${d}`, text);
      localStorage.setItem(`kcal_${d}`, kcal);
      alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    function loadSavedMenu() {
      const d = document.getElementById('dateSelector').value;
      const menu = localStorage.getItem(`menu_${d}`);
      document.getElementById('savedMenuDisplay').innerHTML =
        menu ? `<p><strong>${d}</strong>: ${menu}</p>` : `<p>${d} ì €ì¥ëœ ë©”ë‰´ ì—†ìŒ</p>`;
    }

    function loadWeeklySummary() {
      const div = document.getElementById('weeklySummary');
      div.innerHTML = '';
      const now = new Date();
      const start = new Date(now);
      start.setDate(now.getDate() - now.getDay());
      let total = 0, count = 0;
      let html = '';
      for (let i = 0; i < 7; i++) {
        const d = new Date(start);
        d.setDate(start.getDate() + i);
        const k = d.toISOString().split("T")[0];
        const m = localStorage.getItem(`menu_${k}`);
        const c = parseInt(localStorage.getItem(`kcal_${k}`)) || 0;
        if (m) {
          html += `<p>${k}: ${m} (${c} kcal)</p>`;
          total += c; count++;
        }
      }
      html += `<hr><p><strong>ì´ ì¹¼ë¡œë¦¬:</strong> ${total} kcal<br><strong>í‰ê· :</strong> ${count ? Math.round(total / count) : 0} kcal</p>`;
      div.innerHTML = html || '<p>ì´ë²ˆ ì£¼ ê¸°ë¡ ì—†ìŒ</p>';
    }

    loadRecipes();
  </script>
</body>
</html>
