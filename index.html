<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>오늘 뭐 먹지?</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Arial&display=swap" />
  <style>
    body { font-family: Arial, sans-serif; background: #fafafa; padding: 20px; }
    h1 { text-align: center; }
    .container { max-width: 600px; margin: auto; }
    input, select, button { width: 100%; margin: 8px 0; padding: 10px; border-radius: 6px; border: 1px solid #ccc; }
    button { background-color: #f97316; color: white; font-weight: bold; box-shadow: 0 4px #d65a00; }
    button:active { transform: translateY(2px); box-shadow: 0 2px #b94700; }
    .result-card { background: #fff; padding: 15px; margin-top: 16px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .highlight { font-weight: bold; color: #f97316; }
    .actions button { width: 48%; margin-top: 5px; background: #eee; color: #333; }
    .actions { display: flex; justify-content: space-between; }
    #ingredientList { background: #fff; padding: 10px; border-radius: 6px; min-height: 40px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>오늘 뭐 먹지?</h1>
    <input id="ingredientInput" placeholder="예: 돼지고기" />
    <div style="display:flex; gap:10px;">
      <button onclick="addIngredient()">재료 추가</button>
      <button onclick="resetIngredients()">초기화</button>
    </div>
    <div id="ingredientList"></div>
    <select id="mealType">
      <option value="">식사 유형</option>
      <option>아침</option><option>점심</option><option>저녁</option>
      <option>간식</option><option>야식</option><option>술안주</option><option>도시락</option>
    </select>
    <select id="dietType">
      <option value="">식단 유형</option>
      <option>일반식</option><option>건강식</option><option>다이어트식</option><option>채식</option>
    </select>
    <select id="cookMethod">
      <option value="">조리 방법 (선택없으면 랜덤)</option>
      <option>볶기</option><option>끓이기</option><option>찜</option><option>무침</option><option>굽기</option>
    </select>
    <button onclick="generateMenu()">추천하기</button>
    <button onclick="clearResult()">다시 추천받기</button>
    <div id="result"></div>
  </div>

  <script>
    let ingredients = [], recipeDB = {}, placeholderDB = {};

    async function loadRecipes() {
      try {
        const real = await fetch("/realistic_korean_recipes_500.json");
        const realData = await real.json();
        recipeDB = realData;

        // 예시로 placeholder 로컬 객체 구성 (추후 분리 가능)
        placeholderDB = {
          "레시피 안내": {
            message: "이 메뉴는 등록된 상세 레시피가 없습니다. 포털 검색 또는 블로그를 참고해 주세요.",
            external: "https://search.naver.com/search.naver?query=한식레시피"
          }
        };
      } catch (e) {
        alert("레시피 데이터를 불러오는 데 실패했습니다.");
      }
    }

    function addIngredient() {
      const input = document.getElementById('ingredientInput');
      if (input.value.trim()) {
        ingredients.push(input.value.trim());
        input.value = '';
        document.getElementById('ingredientList').innerText = ingredients.join(', ');
      }
    }

    function resetIngredients() {
      ingredients = [];
      document.getElementById('ingredientList').innerText = '';
    }

    function clearResult() {
      document.getElementById('result').innerHTML = '';
    }

    function generateMenu() {
      const keys = Object.keys(recipeDB);
      if (!keys.length || !ingredients.length) {
        alert("재료를 입력해 주세요.");
        return;
      }

      const randomKey = keys[Math.floor(Math.random() * keys.length)];
      const recipe = recipeDB[randomKey];
      if (!recipe || !recipe.steps) {
        const msg = placeholderDB["레시피 안내"];
        document.getElementById('result').innerHTML = `
          <div class="result-card">
            <strong>레시피 없음</strong><br>
            <p>${msg.message}</p>
            <a href="${msg.external}" target="_blank">외부 레시피 검색</a>
          </div>
        `;
        return;
      }

      const result = `
        <div class="result-card">
          <strong>${recipe.menu || randomKey}</strong><br>
          <div><strong>칼로리:</strong> ${recipe.kcal} kcal</div>
          <div><strong>조리 방법:</strong> ${recipe.method}</div>
          <div><strong>재료:</strong> ${recipe.ingredients.join(', ')}</div>
          <div><strong>조리 순서:</strong><ol>${recipe.steps.map(s => `<li>${s}</li>`).join('')}</ol></div>
          <div><strong>TIP:</strong> ${recipe.tip}</div>
        </div>
      `;
      document.getElementById('result').innerHTML = result;
    }

    loadRecipes();
  </script>
</body>
</html>
