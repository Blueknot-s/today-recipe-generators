<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì˜¤ëŠ˜ ë¬´ì—‡ë¨¹ì§€?</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Arial&display=swap" />
  <style>
    body { font-family: Arial, sans-serif; background: #fafafa; padding: 20px; }
    h1 { text-align: center; }
    .container { max-width: 600px; margin: auto; }
    input, select, button { width: 100%; margin: 8px 0; padding: 10px; border-radius: 6px; border: 1px solid #ccc; }
    button { background-color: #f97316; color: white; font-weight: bold; box-shadow: 0 4px #d65a00; }
    button:active { transform: translateY(2px); box-shadow: 0 2px #b94700; }
    .result-card { background: #fff; padding: 15px; margin-top: 16px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .highlight { font-weight: bold; color: #f97316; }
    .actions button { width: 48%; margin-top: 5px; background: #eee; color: #333; }
    .actions { display: flex; justify-content: space-between; }
    #ingredientList { background: #fff; padding: 10px; border-radius: 6px; min-height: 40px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¥¤ ì˜¤ëŠ˜ ë¬´ì—‡ì§€?</h1>
    <input id="ingredientInput" placeholder="ì˜ˆ: ëŒ€ì§€ê³ ê¸°" />
    <div style="display:flex; gap:10px;">
      <button onclick="addIngredient()">ì¬ë£Œ ì¶”ê°€</button>
      <button onclick="resetIngredients()">ì´ˆê¸°í™”</button>
    </div>
    <div id="ingredientList"></div>
    <select id="mealType">
      <option value="">ì‹ì‚¬ ìœ í˜•</option>
      <option>ì•„ì¹¨</option><option>ì ì‹¬</option><option>ì €ë…</option>
      <option>ê°„ì‹</option><option>ì•¼ì‹</option><option>ìˆ ì•ˆì£¼</option><option>ë„ì‹œëŸ¬í¬</option>
    </select>
    <select id="dietType">
      <option value="">ì‹ë‹¹ ìœ í˜•</option>
      <option>ì¼ë°˜ì‹</option><option>ê±´ê°•ì‹</option><option>ë‹¤ì´ì–´í„°ì‹</option><option>ì°¨ì‹</option>
    </select>
    <select id="cookMethod">
      <option value="">ì¡°ë¦¬ ë°©ë²• (ì„ íƒì—†ìœ¼ë©´ ëœë¤)</option>
      <option>ë³±ê¸°</option><option>\ë“ì´ê¸°</option><option>ì ‘</option><option>ë¬´ì¹˜ê¸°</option><option>êµ´ê¸°</option>
    </select>
    <button onclick="generateMenu()">ì¶”ì²œí•˜ê¸°</button>
    <button onclick="clearResult()">ë‹¤ì‹œ ì¶”ì²œë°›ê¸°</button>
    <div id="result"></div>

    <h3>ë‚ ì§œë³„ ë©”ë‰´ ê¸°ë¡</h3>
    <input type="date" id="dateSelector" onchange="loadSavedMenu()" />
    <div id="savedMenuDisplay"></div>

    <h3>ì£¼ê°„ ì‹ë‹¹ ìš”ì•½</h3>
    <button onclick="loadWeeklySummary()">ì´ë³¸ ì£¼ ìš”ì•½ ë³´ê¸°</button>
    <div id="weeklySummary"></div>
  </div>

  <script>
    let ingredients = [], recipeDB = {};

    async function loadRecipes() {
      const res = await fetch("https://today-recipe-generators.vercel.app/realistic_korean_recipes_500.json");
      recipeDB = await res.json();
    }

    function addIngredient() {
      const input = document.getElementById('ingredientInput');
      if (input.value.trim()) {
        ingredients.push(input.value.trim());
        input.value = '';
        document.getElementById('ingredientList').innerText = ingredients.join(', ');
      }
    }

    function resetIngredients() {
      ingredients = [];
      document.getElementById('ingredientList').innerText = '';
    }

    function clearResult() {
      document.getElementById('result').innerHTML = '';
    }

    function generateMenu() {
      const meal = document.getElementById('mealType').value;
      const diet = document.getElementById('dietType').value;
      const method = document.getElementById('cookMethod').value;
      if (!ingredients.length || !meal || !diet) return alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.');

      const recipes = Object.values(recipeDB).filter(r =>
        r.mealType === meal &&
        r.dietType === diet &&
        (!method || r.method === method) &&
        r.ingredients.some(i => ingredients.includes(i))
      );

      if (recipes.length === 0) {
        document.getElementById('result').innerHTML = '<p>ì¡°ê±´ì— ë§ëŠ” ë©”ë‰´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }

      const recipe = recipes[Math.floor(Math.random() * recipes.length)];
      const result = `
        <div class="result-card">
          <strong>${recipe.menu}</strong>
          <div><strong>ì¹´ë¡œë¦¬:</strong> ${recipe.kcal} kcal</div>
          <div><strong>ì¡°ë¦¬ ë°©ë²•:</strong> ${recipe.method}</div>
          <div><strong>ì¬ë£Œ:</strong> ${recipe.ingredients.join(', ')}</div>
          <div><strong>ì¡°ë¦¬ ìˆœì„œ:</strong><br>
            <ol>${recipe.steps.map(s => `<li>${s}</li>`).join('')}</ol>
          </div>
          <div><strong>TIP:</strong> ${recipe.tip}</div>
        </div>
      `;
      document.getElementById('result').innerHTML = result;
    }

    function copyMenu(text) {
      navigator.clipboard.writeText(text);
      alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    function saveMenu(text, kcal) {
      const d = new Date().toISOString().split("T")[0];
      localStorage.setItem(`menu_${d}`, text);
      localStorage.setItem(`kcal_${d}`, kcal);
      alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    function loadSavedMenu() {
      const d = document.getElementById('dateSelector').value;
      const menu = localStorage.getItem(`menu_${d}`);
      document.getElementById('savedMenuDisplay').innerHTML =
        menu ? `<p><strong>${d}</strong>: ${menu}</p>` : `<p>${d} ì €ì¥ëœ ë©”ë‰´ ì—†ìŒ</p>`;
    }

    function loadWeeklySummary() {
      const div = document.getElementById('weeklySummary');
      div.innerHTML = '';
      const now = new Date();
      const start = new Date(now);
      start.setDate(now.getDate() - now.getDay());
      let total = 0, count = 0;
      let html = '';
      for (let i = 0; i < 7; i++) {
        const d = new Date(start);
        d.setDate(start.getDate() + i);
        const k = d.toISOString().split("T")[0];
        const m = localStorage.getItem(`menu_${k}`);
        const c = parseInt(localStorage.getItem(`kcal_${k}`)) || 0;
        if (m) {
          html += `<p>${k}: ${m} (${c} kcal)</p>`;
          total += c; count++;
        }
      }
      html += `<hr><p><strong>ì°¨ì§€ ì¹´ë¡œë¦¬:</strong> ${total} kcal<br><strong>í‰ê· :</strong> ${count ? Math.round(total / count) : 0} kcal</p>`;
      div.innerHTML = html || '<p>ì´ë³¸ ì£¼ ê¸°ë¡ ì—†ìŒ</p>';
    }

    loadRecipes();
  </script>
</body>
</html>
